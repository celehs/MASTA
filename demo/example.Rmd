---
title: "PETLER Example"
author: "https://celehs.github.io/PETLER/"
---

```{r, include=F}
options(width = 100)
```

## Prerequisites


If `PETLER` is not installed, uncomment the code below and install it from GitHub.

```{r}
# devtools::install_github("celehs/PETLER")
```

Load the `PETLER` package into R.

```{r}
library(PETLER)
```

## Input Data

Load the sample data from the `PETLER` package. Use `?data_org` or click [HERE](https://celehs.github.io/PETLER/reference/data_org.html) to view the data format and variable definitions.

```{r}
data(data_org)
```

The first two data tables consists of labeled training and validation data with survival outcome (`event_ind`, `event_time`, `fu_time`) and baseline covariates (`cov_1`-`cov_3`).

```{r}
data_org[1:2]
```

The first two data tables consists of training and validation longitudinal encounters. `fu_time` is the length of follow-up time and `pred1`-`pred3` are the numbers of medical occurrences in each month (from baseline). Before running the PETLER algorithm, the variable `month` will be standarzied (internally) by the follow-up time to ensure the standarzied time is between 0 and 1 for all patients. 

```{r}
data_org[3:4]
```

__NOTE__: If you plan to use your own data, you need to prepare it in the order of the variables in the sample data.

## Base Creation

Next, we can use the `petler.base` function to create the base functions required to run the PETLER algorithm. By default, you only need to provide data in the list format mentioned above. However, you can view the help documentation (`?petler.base`) or click [HERE](https://celehs.github.io/PETLER/reference/petler.base.html) to customize configurable arguments.

```{r, eval=T}
system.time(obj <- petler.base(data_org))
```

In order to analyze very large data, the `petler.base` function uses multi-core parallel computing by default (`n_core = 4`).

```{r}
names(obj)
```

## PETLER Output

We can now run the PETLER algorithm by calling the `petler` function and providing the base object obtained from the previous step. Use `?petler` or click [HERE](https://celehs.github.io/PETLER/reference/petler.html) to view help documentation and configurable arguments.

```{r, eval=T}
system.time(out <- petler(obj))
```

The `petler` function returns the following list of results:

- `bgbbest_FromChengInit_BFGS` Details of the fitted model

- `Cstat_BrierSc_ChengInit_BFGS` C-statistics and adjusted Brier scores of the derived algorithm

- `group` A vector of consecutive integers describing the grouping coefficients

```{r, eval=T}
out
```
